version: '3.8'

services:
  backend:
    image: markoff-backend:dev
    container_name: markoff-backend
    ports:
      - "8000:8000"
    volumes:
      - ./backend/src:/app/src:cached
    environment:
      - DATABASE_URL=postgresql+psycopg2://markoff:1@192.168.2.4:5432/markoff2_0_db
      - ENVIRONMENT=development
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
    # healthcheck полностью удален

  client:
    image: markoff-client:dev
    container_name: markoff-client
    build:
      context: ./client
      dockerfile: ../docker/Dockerfile.client
    depends_on:
      - backend  # просто зависит от backend, без условия healthcheck
    environment:
      - DISPLAY=host.docker.internal:0
    volumes:
      - ./client/src:/app/src:cached
      - /tmp/.X11-unix:/tmp/.X11-unix
    network_mode: host
    restart: unless-stopped